---
// DailyMail.astro - Complete component with auto-flow styling

// Import stories from data file
import { allStories } from '../data/stories.js';

// AUTO-SORT BY DATE AND ASSIGN POSITIONS
const sortedStories = allStories.sort((a, b) => new Date(b.date) - new Date(a.date));

// AUTO-ASSIGN POSITIONS BASED ON DATE ORDER
const featuredStory = sortedStories[0];
const secondaryStories1 = sortedStories.slice(1, 3);
const previousStory = sortedStories[3];
const secondaryStories2 = sortedStories.slice(4, 6);

// Helper function to format dates
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: 'numeric' 
  });
}
---

<section class="daily-mail-section">
  <div class="container">
    
    <!-- Main Content Grid -->
    <div class="main-grid">
      
      <!-- Stories Flow -->
      <div class="stories-flow">
        
        <!-- FEATURED STORY - 1 WIDE -->
        <article class="story-card featured">
          <div class="story-content">
            <h3 class="story-headline">{featuredStory.title}</h3>
          </div>
          <div class="story-video">
            <a href={featuredStory.link} class="video-link">
              <img 
                src={`https://img.youtube.com/vi/${featuredStory.youtubeId}/maxresdefault.jpg`}
                alt={featuredStory.title}
                class="video-thumbnail"
              />
              <div class="play-button">‚ñ∂</div>
            </a>
            <div class="story-badge">{featuredStory.badge}</div>
          </div>
          <div class="story-content">
            <p class="story-excerpt">{featuredStory.excerpt}</p>
            <div class="story-footer">
              <span class="story-date-small">{formatDate(featuredStory.date)}</span>
              <a href={featuredStory.link} class="read-more">Read Full Story ‚Üí</a>
            </div>
          </div>
        </article>

        <!-- SECONDARY STORIES ROW 1 - 2 WIDE -->
        <div class="story-row">
          {secondaryStories1.map(story => (
            <article class="story-card secondary">
              <div class="story-content">
                <h3 class="story-headline">{story.title}</h3>
              </div>
              <div class="story-video">
                <a href={story.link} class="video-link">
                  <img 
                    src={`https://img.youtube.com/vi/${story.youtubeId}/maxresdefault.jpg`}
                    alt={story.title}
                    class="video-thumbnail"
                  />
                  <div class="play-button">‚ñ∂</div>
                </a>
                <div class="story-badge">{story.badge}</div>
              </div>
              <div class="story-content">
                <p class="story-excerpt">{story.excerpt}</p>
                <div class="story-footer">
                  <span class="story-date-small">{formatDate(story.date)}</span>
                  <a href={story.link} class="read-more">Read Full Story ‚Üí</a>
                </div>
              </div>
            </article>
          ))}
        </div>

        <!-- PREVIOUS STORY - 1 WIDE -->
        {previousStory && (
          <article class="story-card featured">
            <div class="story-content">
              <h3 class="story-headline">{previousStory.title}</h3>
            </div>
            <div class="story-video">
              <a href={previousStory.link} class="video-link">
                <img 
                  src={`https://img.youtube.com/vi/${previousStory.youtubeId}/maxresdefault.jpg`}
                  alt={previousStory.title}
                  class="video-thumbnail"
                />
                <div class="play-button">‚ñ∂</div>
              </a>
              <div class="story-badge">{previousStory.badge}</div>
            </div>
            <div class="story-content">
              <p class="story-excerpt">{previousStory.excerpt}</p>
              <div class="story-footer">
                <span class="story-date-small">{formatDate(previousStory.date)}</span>
                <a href={previousStory.link} class="read-more">Read Full Story ‚Üí</a>
              </div>
            </div>
          </article>
        )}

        <!-- SECONDARY STORIES ROW 2 - 2 WIDE -->
        {secondaryStories2.length > 0 && (
          <div class="story-row">
            {secondaryStories2.map(story => (
              <article class="story-card secondary">
                <div class="story-content">
                  <h3 class="story-headline">{story.title}</h3>
                </div>
                <div class="story-video">
                  <a href={story.link} class="video-link">
                    <img 
                      src={`https://img.youtube.com/vi/${story.youtubeId}/maxresdefault.jpg`}
                      alt={story.title}
                      class="video-thumbnail"
                    />
                    <div class="play-button">‚ñ∂</div>
                  </a>
                  <div class="story-badge">{story.badge}</div>
                </div>
                <div class="story-content">
                  <p class="story-excerpt">{story.excerpt}</p>
                  <div class="story-footer">
                    <span class="story-date-small">{formatDate(story.date)}</span>
                    <a href={story.link} class="read-more">Read Full Story ‚Üí</a>
                  </div>
                </div>
              </article>
            ))}
          </div>
        )}

      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        
        <!-- Categories Widget -->
        <div class="sidebar-widget">
          <h4 class="widget-title">Categories</h4>
          <ul class="category-list">
            <li class="category-item">
              <a href="/category/earthworms" class="category-link">Earthworms</a>
              <span class="category-count">12</span>
            </li>
            <li class="category-item">
              <a href="/category/wood-chips" class="category-link">Wood Chips</a>
              <span class="category-count">8</span>
            </li>
            <li class="category-item">
              <a href="/category/knf" class="category-link">KNF Methods</a>
              <span class="category-count">15</span>
            </li>
            <li class="category-item">
              <a href="/category/soil-health" class="category-link">Soil Health</a>
              <span class="category-count">6</span>
            </li>
          </ul>
        </div>

        <!-- Recent Stories Widget -->
        <div class="sidebar-widget">
          <h4 class="widget-title">Recent Stories</h4>
          
          <article class="recent-story">
            <div class="story-thumb">üå±</div>
            <div class="story-info">
              <h5><a href="/peter/wood-chip-mastery">Peter's Wood Chip Selection Secrets</a></h5>
              <p class="story-meta">Jan 29, 2025</p>
              <p class="story-excerpt">Advanced techniques for optimal carbon ratios...</p>
            </div>
          </article>

          <article class="recent-story">
            <div class="story-thumb">üß™</div>
            <div class="story-info">
              <h5><a href="/master-hun/fermentation-basics">Master Hun's Fermentation Fundamentals</a></h5>
              <p class="story-meta">Jan 28, 2025</p>
              <p class="story-excerpt">Korean Natural Farming principles revealed...</p>
            </div>
          </article>

          <article class="recent-story">
            <div class="story-thumb">üçá</div>
            <div class="story-info">
              <h5><a href="/tony-busatta/vineyard-transformation">The Busatta Vineyard Transformation</a></h5>
              <p class="story-meta">Jan 27, 2025</p>
              <p class="story-excerpt">Three generations of Italian farming wisdom...</p>
            </div>
          </article>
        </div>

        <!-- Newsletter Widget -->
        <div class="sidebar-widget newsletter-widget">
          <h4 class="widget-title">Daily Secrets</h4>
          <p>Get tomorrow's farming insights delivered to your inbox</p>
          <form class="newsletter-form">
            <input 
              type="email" 
              placeholder="Your email" 
              class="newsletter-input"
              required
            >
            <button type="submit" class="newsletter-button">
              Subscribe
            </button>
          </form>
        </div>
      </aside>
    </div>

    <!-- Breaking News Ticker -->
    <div class="breaking-news">
      <div class="breaking-content">
        <span class="breaking-label">BREAKING</span>
        <div class="breaking-text">
          üö® Master Hun reveals breakthrough KNF technique ‚Ä¢ Peter discovers optimal wood chip ratios ‚Ä¢ Tony's CFT system shows 300% yield increase ‚Ä¢ New earthworm species identified in Italian vineyards üö®
        </div>
      </div>
    </div>

  </div>
</section>

<style>
  .daily-mail-section {
    padding: 0px 40px 20px 40px;
    background-color: #f8f9fa;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .main-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 25px;
    margin-bottom: 15px;
  }

  /* Stories Flow - Brutally tight spacing */
  .stories-flow {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .story-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
  }

  .story-card {
    background: white;
    box-shadow: none !important;
  }

  .story-card.featured {
    width: 100%;
  }

  .story-card.secondary {
    width: 100%;
  }

  /* MAIN FEATURED VIDEO - Big and dominant */
  .story-card.featured .story-video {
    position: relative;
    width: 100%;
    height: 400px;
    margin: 1px 0 0 0;
  }

  /* SECONDARY VIDEOS - Full width to match text */
  .story-card.secondary .story-video {
    position: relative;
    width: 100%;
    height: 250px;
    margin: 1px 0 0 0;
  }

  .story-video iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .video-link {
    display: block;
    position: relative;
    width: 100%;
    height: 100%;
    text-decoration: none;
  }

  .video-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
  }

  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.3s ease;
  }

  .play-button:hover {
    background: rgba(255, 0, 0, 0.9);
    transform: translate(-50%, -50%) scale(1.1);
  }

  .story-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #dc2626;
    color: white;
    padding: 6px 12px;
    font-size: 10px;
    font-weight: bold;
    text-transform: uppercase;
    border-radius: 3px;
    z-index: 10;
  }

  .story-content {
    padding: 3px;
  }

  /* Title spacing - super tight to video */
  .story-content + .story-video {
    margin-top: 1px;
  }

  /* Video to description spacing - super tight */
  .story-video + .story-content {
    margin-top: 1px;
  }

  .story-headline {
    font-family: 'Roboto Serif', serif;
    font-weight: 700;
    line-height: 1.1;
    color: #000;
    margin-bottom: 0px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* MASSIVE headlines for featured stories */
  .story-card.featured .story-headline {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 0px;
  }

  /* Smaller headlines for secondary stories */
  .story-card.secondary .story-headline {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 0px;
    line-height: 1.05;
    max-height: 2.1em;
  }

  .story-excerpt {
    color: #000;
    line-height: 1.3;
    margin-bottom: 8px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Larger excerpt text for featured */
  .story-card.featured .story-excerpt {
    font-size: 15px;
    margin-bottom: 10px;
    color: #000;
  }

  /* Smaller excerpt text for secondary */
  .story-card.secondary .story-excerpt {
    font-size: 13px;
    margin-bottom: 6px;
    -webkit-line-clamp: 2;
    color: #000;
  }

  .story-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
  }

  .story-date-small {
    font-size: 11px;
    color: #999;
    font-weight: 500;
  }

  .read-more {
    color: #16008A;
    font-weight: 600;
    text-decoration: none;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .read-more:hover {
    opacity: 0.8;
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .sidebar-widget {
    background: white;
    border-radius: 8px;
    box-shadow: none !important;
    padding: 18px;
  }

  .widget-title {
    font-family: 'Roboto Serif', serif;
    font-size: 20px;
    font-weight: 300;
    margin-bottom: 15px;
    color: #000;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 8px;
  }

  .category-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f5f5f5;
  }

  .category-item:last-child {
    border-bottom: none;
  }

  .category-link {
    color: #333;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.3s ease;
  }

  .category-link:hover {
    color: #16008A;
  }

  .category-count {
    background: #f0f0f0;
    color: #666;
    padding: 2px 8px;
    font-size: 12px;
    border-radius: 10px;
  }

  .recent-story {
    display: flex;
    gap: 15px;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f0;
  }

  .recent-story:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .story-thumb {
    width: 60px;
    height: 60px;
    background: #f0f0f0;
    border-radius: 4px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  .story-info h5 {
    font-size: 14px;
    font-weight: 600;
    margin: 0 0 5px 0;
    line-height: 1.3;
  }

  .story-info h5 a {
    color: #000;
    text-decoration: none;
  }

  .story-info h5 a:hover {
    color: #16008A;
  }

  .story-meta {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
  }

  .story-excerpt {
    font-size: 12px;
    color: #888;
    line-height: 1.4;
  }

  .newsletter-widget {
    background: linear-gradient(135deg, #16008A 0%, #1e0a9e 100%);
    color: white;
    text-align: center;
  }

  .newsletter-widget .widget-title {
    color: white;
    border-bottom-color: rgba(255,255,255,0.2);
  }

  .newsletter-widget p {
    margin-bottom: 20px;
    opacity: 0.9;
  }

  .newsletter-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .newsletter-input {
    padding: 12px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
  }

  .newsletter-button {
    background: white;
    color: #16008A;
    border: none;
    padding: 12px;
    border-radius: 4px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }

  .newsletter-button:hover {
    opacity: 0.9;
  }

  .breaking-news {
    background: #dc2626;
    color: white;
    padding: 15px;
    border-radius: 8px;
    overflow: hidden;
    position: relative;
  }

  .breaking-content {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .breaking-label {
    background: white;
    color: #dc2626;
    padding: 8px 12px;
    font-weight: bold;
    font-size: 12px;
    border-radius: 4px;
    white-space: nowrap;
  }

  .breaking-text {
    font-size: 14px;
    animation: scroll 45s linear infinite;
    white-space: nowrap;
  }

  @keyframes scroll {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .main-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .daily-mail-section {
      padding: 15px 20px;
    }
    
    .story-row {
      grid-template-columns: 1fr;
    }
    
    .story-card.featured .story-video {
      height: 250px;
      margin-top: 30px;
    }
    
    .story-card.secondary .story-video {
      height: 200px;
      margin-top: 30px;
    }
    
    .story-card.featured .story-headline {
      font-size: 24px !important;
    }
    
    .story-card.secondary .story-headline {
      font-size: 16px !important;
    }
  }
</style>